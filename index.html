<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Amora Secreta Sua Loja √çntima Online</title>
<meta name="description" content="Descubra os melhores produtos er√≥ticos com entrega discreta, seguran√ßa e o melhor pre√ßo do Brasil." />
<style>
  /* Reset + base */
  *{box-sizing:border-box;margin:0;padding:0;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
  body{background:#f8f8f8;color:#222;line-height:1.45}
  a{color:inherit;text-decoration:none}
  button{cursor:pointer}

  /* Container */
  .container{max-width:1200px;margin:0 auto;padding:0 16px}

  /* Header */
  header{background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.06);position:sticky;top:0;z-index:150}
  .top-bar{background:#8a1b61;color:#fff;padding:8px 0;font-size:14px}
  .top-bar .container{display:flex;justify-content:space-between;align-items:center}
  .header-main{padding:12px 0}
  .header-content{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .logo{font-weight:800;color:#8a1b61;font-size:22px;cursor:pointer}
  .search-bar{flex:1;max-width:560px;margin:0 18px;position:relative}
  .search-bar input{width:100%;padding:10px 14px;border-radius:30px;border:1px solid #ddd;font-size:14px}
  .search-bar button{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:0;font-size:18px;color:#8a1b61}
  .user-actions{display:flex;gap:14px;align-items:center}

  .cart-count{background:#8a1b61;color:#fff;border-radius:50%;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;font-size:11px;margin-left:6px}

  /* Nav */
  nav{background:#8a1b61}
  .nav-container{max-width:1200px;margin:0 auto}
  .nav-menu{display:flex;flex-wrap:wrap;gap:6px;list-style:none;padding:8px 16px}
  .nav-menu button{background:transparent;border:0;color:#fff;padding:8px 12px;border-radius:6px;font-weight:600}
  .nav-menu button:hover{background:#6a1449}

  /* Hero */
  .hero{height:420px;background:linear-gradient(rgba(0,0,0,.32), rgba(0,0,0,.32)),url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');background-size:cover;background-position:center;color:#fff;display:flex;align-items:center}
  .hero .hero-inner{max-width:640px;padding:28px}
  .hero h1{font-size:36px;margin-bottom:10px}
  .hero p{font-size:16px;margin-bottom:18px}
  .btn{background:#8a1b61;color:#fff;padding:10px 18px;border-radius:30px;border:0;font-weight:700}
  .btn:hover{background:#6a1449}

  /* Products */
  .section{padding:42px 0}
  .section-title{text-align:center;margin-bottom:22px;font-size:26px;color:#333}
  .products{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
  .product-card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 5px 14px rgba(0,0,0,.04);display:flex;flex-direction:column}
  .product-img{height:180px;background:#f5f5f5;display:flex;align-items:center;justify-content:center;font-size:34px}
  .product-img img{width:100%;height:100%;object-fit:cover;display:block}
  .product-body{padding:12px;flex:1;display:flex;flex-direction:column}
  .product-title{font-weight:700;font-size:14px;margin-bottom:6px;min-height:38px}
  .product-price{color:#8a1b61;font-weight:800;margin-bottom:8px}
  .product-actions{margin-top:auto;display:flex;gap:8px}
  .small-btn{padding:8px 10px;border-radius:8px;border:0;background:#eee}
  .add-btn{background:#8a1b61;color:#fff;border:0;padding:8px 12px;border-radius:8px}

  /* Cart drawer */
  .cart-drawer{position:fixed;right:0;top:0;height:100%;width:380px;background:#fff;box-shadow:-12px 0 30px rgba(0,0,0,.08);z-index:200;transform:translateX(100%);transition:transform .25s;padding:18px;display:flex;flex-direction:column}
  .cart-drawer.open{transform:translateX(0)}
  .cart-items{flex:1;overflow:auto;margin-top:8px}
  .cart-item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid #f1f1f1}
  .cart-item img{width:64px;height:64px;border-radius:6px;background:#f5f5f5;object-fit:cover}
  .cart-footer{border-top:1px solid #eee;padding-top:12px}

  /* Modal (payment) */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:300;align-items:center;justify-content:center;padding:18px}
  .modal.open{display:flex}
  .modal-content{background:#fff;padding:18px;border-radius:10px;max-width:760px;width:100%;max-height:90vh;overflow:auto}
  .modal-grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
  .pix-code{background:#f5f5f5;padding:12px;border-radius:6px;word-break:break-all}
  .qr-img{max-width:100%;border-radius:8px;border:1px solid #eee}

  /* Footer */
  footer{background:#333;color:#ddd;padding:36px 0}
  .footer-columns{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px}
  .footer-columns h3{color:#fff;margin-bottom:8px}
  .footer-bottom{text-align:center;margin-top:14px;border-top:1px solid rgba(255,255,255,.06);padding-top:12px;font-size:14px}

  /* WhatsApp float */
  .whatsapp-float{position:fixed;right:18px;bottom:18px;background:#25D366;color:#fff;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:26px;z-index:400;box-shadow:0 4px 18px rgba(0,0,0,.15)}
  .whatsapp-float:hover{transform:scale(1.04)}

  /* Responsive */
  @media(max-width:1000px){.products{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:760px){.header-content{flex-direction:column;align-items:flex-start}.products{grid-template-columns:repeat(1,1fr)}.modal-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <!-- Top header -->
  <header>
    <div class="top-bar">
      <div class="container">
        <div>Frete gr√°tis acima de R$ 199</div>
        <div>Atendimento: (35) 99973-9111</div>
      </div>
    </div>

    <div class="header-main">
      <div class="container header-content">
        <div style="display:flex;align-items:center;gap:12px">
          <div class="logo" id="logoBtn">AMORA SECRETA</div>
        </div>

        <div class="search-bar">
          <input id="searchInput" placeholder="O que voc√™ est√° procurando? (ex: vibrador)" />
          <button onclick="document.getElementById('searchInput').focus()">üîç</button>
        </div>

        <div class="user-actions">
          <!-- Minha Conta e Favoritos removidos -->
          <div id="open-cart-btn" style="cursor:pointer">üõí<span class="cart-count" id="cart-count">0</span></div>
        </div>
      </div>
    </div>

    <nav>
      <div class="nav-container">
        <ul class="nav-menu container" id="navMenu"></ul>
      </div>
    </nav>
  </header>

  <!-- Hero (aparece s√≥ na P√°gina Inicial) -->
  <section id="hero" class="hero">
    <div class="container hero-inner">
      <h1>Descubra o prazer com discri√ß√£o</h1>
      <p>Os melhores produtos para sua intimidade com total privacidade e entrega r√°pida.</p>
      <button class="btn" onclick="goHome()">Comprar Agora</button>
    </div>
  </section>

  <!-- Main products -->
  <main>
    <section class="section" id="productsSection">
      <div class="container">
        <h2 class="section-title" id="sectionTitle">Produtos em Destaque</h2>
        <div class="products" id="productsGrid"></div>
      </div>
    </section>
  </main>

  <!-- Cart drawer -->
  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Carrinho</h3>
      <div><button class="btn" id="closeCartBtn">Fechar</button></div>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-footer">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <strong>Total:</strong>
        <strong id="cartTotal">R$ 0,00</strong>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="checkoutBtn" style="flex:1">Finalizar Compra</button>
        <button class="small-btn" id="clearCartBtn" style="background:#eee">Limpar</button>
      </div>
    </div>
  </aside>

  <!-- Payment modal -->
  <div class="modal" id="paymentModal" aria-hidden="true">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <h2>Op√ß√µes de Pagamento</h2>
        <button id="closePaymentModal" style="background:none;border:0;font-size:22px">&times;</button>
      </div>

      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
        <button class="btn" id="pixOption">PIX</button>
        <button class="btn" id="cardOption">Cart√£o (Simulado)</button>
        <button class="btn" id="boletoOption">Boleto (Simulado)</button>
      </div>

      <div class="modal-grid">
        <div>
          <!-- PIX -->
          <div id="pixPanel">
            <h3>Pagamento via PIX</h3>
            <p>Chave PIX (telefone): <strong id="pixKeyDisplay">35999739111</strong></p>
            <div class="pix-code" id="pixCopyArea">‚Äî</div>

            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="copyPixBtn">Copiar C√≥digo PIX (com valor)</button>
              <button class="small-btn" id="showQrBtn">Mostrar QR</button>
              <button class="btn" id="whatsappPayBtn">Enviar pelo WhatsApp</button>
            </div>

            <p style="margin-top:10px;color:#444;font-size:14px">
              Instru√ß√µes: copie o c√≥digo e cole no seu app banc√°rio em "Pagar com PIX - Copiar/colar" ou escaneie o QR.
            </p>
          </div>

          <!-- Card -->
          <div id="cardPanel" style="display:none">
            <h3>Cart√£o de Cr√©dito (Simulado)</h3>
            <p>Integra√ß√£o real: Mercado Pago, Pagar.me, PagSeguro etc. ‚Äî aqui √© apenas simula√ß√£o.</p>
            <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
              <input placeholder="N√∫mero do cart√£o" style="padding:10px;border-radius:6px;border:1px solid #ddd" />
              <input placeholder="Nome no cart√£o" style="padding:10px;border-radius:6px;border:1px solid #ddd" />
              <div style="display:flex;gap:8px">
                <input placeholder="MM/AA" style="flex:1;padding:10px;border-radius:6px;border:1px solid #ddd" />
                <input placeholder="CVV" style="width:100px;padding:10px;border-radius:6px;border:1px solid #ddd" />
              </div>
              <button class="btn" id="simulateCardBtn">Pagar (Simulado)</button>
            </div>
          </div>

          <!-- Boleto -->
          <div id="boletoPanel" style="display:none">
            <h3>Boleto (Simulado)</h3>
            <p>O boleto ser√° enviado por e-mail (simula√ß√£o).</p>
            <button class="btn" id="simulateBoletoBtn">Gerar Boleto (Simulado)</button>
          </div>
        </div>

        <div style="border-left:1px solid #f1f1f1;padding-left:12px">
          <h4>Resumo do Pedido</h4>
          <div id="miniCartSummary" style="margin-bottom:8px;color:#333"></div>
          <div style="margin-top:8px">
            <strong>Total: </strong><span id="modalTotal">R$ 0,00</span>
          </div>

          <div id="qrBox" style="margin-top:12px;display:none">
            <p style="margin-bottom:6px"><strong>QR Code (BR Code PIX)</strong></p>
            <img id="qrImage" class="qr-img" alt="QR Code PIX" />
            <p style="margin-top:8px;font-size:13px;color:#555">Se o seu banco n√£o reconhecer o QR, copie o c√≥digo e cole no app.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-columns">
        <div>
          <h3>Institucional</h3>
          <ul style="list-style:none;padding:0;color:#ddd">
            <li>Sobre N√≥s</li>
            <li>Nossas Lojas</li>
            <li>Pol√≠tica de Privacidade</li>
            <li>Termos de Uso</li>
          </ul>
        </div>
        <div>
          <h3>Atendimento</h3>
          <ul style="list-style:none;padding:0;color:#ddd">
            <li>Central de Ajuda</li>
            <li>Perguntas Frequentes</li>
            <li>Formas de Pagamento</li>
            <li>Trocas e Devolu√ß√µes</li>
          </ul>
        </div>
        <div>
          <h3>Formas de Pagamento</h3>
          <div style="display:flex;gap:8px;margin-top:6px">
            <div style="width:48px;height:28px;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center">üí≥</div>
            <div style="width:48px;height:28px;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center">üì±</div>
          </div>
        </div>
        <div>
          <h3>Contato</h3>
          <div style="color:#ddd">
            <div>üìû (35) 99973-9111</div>
            <div>‚úâÔ∏è g6pousoalegre@gmail.com</div>
            <div>üìç Itajub√° - MG</div>
            <div style="margin-top:8px">Siga-nos:
              <span style="display:inline-block;margin-left:6px">üìò üì∑ üê¶</span>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        Amora Secreta ¬© 2025 - Todos os direitos reservados - CNPJ: 00.000.000/0000-00
      </div>
    </div>
  </footer>

  <!-- WhatsApp floating -->
  <a class="whatsapp-float" href="https://wa.me/5535999739111" target="_blank" title="Fale conosco">
    üíö
  </a>

<script>
/* ======================
   Configura√ß√µes da loja
   ====================== */
const STORE_NAME = 'AMORA SECRETA';
const STORE_PHONE_INTERNAL = '5535999739111'; // para links wa.me
const STORE_PHONE_DISPLAY = '(35) 99973-9111';
const PIX_KEY = '35999739111';
const CATEGORIES = [
  { key:'home', label:'üè† P√°gina Inicial' },
  { key:'salao', label:'üè∑Ô∏è Sald√£o' },
  { key:'mais-vendidos', label:'üî• Mais Vendidos' },
  { key:'vibradores', label:'üîä Vibradores' },
  { key:'masturbadores', label:'üéØ Masturbadores' },
  { key:'acessorios', label:'üéÅ Acess√≥rios Er√≥ticos' },
  { key:'brinquedos', label:'üéÆ Brinquedos Er√≥ticos' },
  { key:'cosmeticos', label:'üíÑ Cosm√©ticos Er√≥ticos' },
  { key:'proteses', label:'üîå Pr√≥teses e Plugs' },
  { key:'fantasia', label:'üëó Fantasia Er√≥tica' },
  { key:'lingeries', label:'üëô Lingeries' },
  { key:'sado', label:'‚õìÔ∏è Sado e Fetiche' },
  { key:'higiene', label:'üß¥ Cuidados e Higiene' },
  { key:'contato', label:'üìû Contato' }
];

/* Produtos espec√≠ficos por categoria - todos cadastrados individualmente */
const PRODUCTS_BY_CATEGORY = {
  vibradores: [
    { id: 'vibrador-1', title: 'Vibrador Bullet', price: 59.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-2', title: 'Vibrador Rabbit', price: 129.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-3', title: 'Vibrador Pontal', price: 79.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-4', title: 'Vibrador Duplo', price: 149.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-5', title: 'Vibrador Control Remoto', price: 169.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-6', title: 'Vibrador Anal', price: 89.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-7', title: 'Vibrador Wand', price: 199.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-8', title: 'Vibrador G-Spot', price: 119.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-9', title: 'Vibrador Silicone', price: 99.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-10', title: 'Vibrador Realista', price: 139.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-11', title: 'Vibrador M√°gico', price: 109.90, img: 'images/gel/gelteste.png', category: 'vibradores' },
    { id: 'vibrador-12', title: 'Vibrador Premium', price: 229.90, img: 'images/gel/gelteste.png', category: 'vibradores' }
  ],
  masturbadores: [
    { id: 'masturbador-1', title: 'Masturbador Pussy', price: 89.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-2', title: 'Masturbador An√°l', price: 99.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-3', title: 'Masturbador Realista', price: 129.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-4', title: 'Masturbador Vibrat√≥rio', price: 159.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-5', title: 'Masturbador Duplo', price: 179.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-6', title: 'Masturbador Pocket', price: 69.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-7', title: 'Masturbador T√©rmico', price: 139.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-8', title: 'Masturbador Silicone', price: 119.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-9', title: 'Masturbador Control Remoto', price: 199.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-10', title: 'Masturbador Premium', price: 229.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-11', title: 'Masturbador Masculino', price: 149.90, img: 'images/gel/gelteste.png', category: 'masturbadores' },
    { id: 'masturbador-12', title: 'Masturbador Feminino', price: 139.90, img: 'images/gel/gelteste.png', category: 'masturbadores' }
  ],
  cosmeticos: [
    { id: 'cosmetico-1', title: 'Gel Excitante', price: 49.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-2', title: 'Lubrificante √çntimo', price: 39.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-3', title: '√ìleo Massagem', price: 59.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-4', title: 'Gel Sensitivo', price: 44.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-5', title: 'Lubrificante Aquecedor', price: 54.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-6', title: 'Gel Esfriante', price: 47.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-7', title: '√ìleo Corporal', price: 62.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-8', title: 'Lubrificante Saborizado', price: 42.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-9', title: 'Gel Er√≥tico', price: 51.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-10', title: '√ìleo Sensual', price: 67.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-11', title: 'Lubrificante Natural', price: 37.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' },
    { id: 'cosmetico-12', title: 'Gel √çntimo', price: 45.90, img: 'images/gel/gelteste.png', category: 'cosmeticos' }
  ],
  acessorios: [
    { id: 'acessorio-1', title: 'Anel Peniano', price: 29.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-2', title: 'Algemas de Veludo', price: 49.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-3', title: 'Venda Sensual', price: 19.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-4', title: 'Spanker', price: 39.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-5', title: 'Cinta Peniana', price: 59.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-6', title: 'Bolas Ben Wa', price: 69.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-7', title: 'Pingente Er√≥tico', price: 24.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-8', title: 'Coleira de Couro', price: 34.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-9', title: 'M√°scara Sensual', price: 27.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-10', title: 'Bengala Er√≥tica', price: 44.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-11', title: 'Pulseira de Couro', price: 31.90, img: 'images/gel/gelteste.png', category: 'acessorios' },
    { id: 'acessorio-12', title: 'Kit Acess√≥rios', price: 89.90, img: 'images/gel/gelteste.png', category: 'acessorios' }
  ],
  brinquedos: [
    { id: 'brinquedo-1', title: 'Brinquedo Er√≥tico 1', price: 79.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-2', title: 'Brinquedo Er√≥tico 2', price: 89.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-3', title: 'Brinquedo Er√≥tico 3', price: 99.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-4', title: 'Brinquedo Er√≥tico 4', price: 109.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-5', title: 'Brinquedo Er√≥tico 5', price: 119.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-6', title: 'Brinquedo Er√≥tico 6', price: 129.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-7', title: 'Brinquedo Er√≥tico 7', price: 139.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-8', title: 'Brinquedo Er√≥tico 8', price: 149.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-9', title: 'Brinquedo Er√≥tico 9', price: 159.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-10', title: 'Brinquedo Er√≥tico 10', price: 169.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-11', title: 'Brinquedo Er√≥tico 11', price: 179.90, img: 'images/gel/gelteste.png', category: 'brinquedos' },
    { id: 'brinquedo-12', title: 'Brinquedo Er√≥tico 12', price: 189.90, img: 'images/gel/gelteste.png', category: 'brinquedos' }
  ],
  proteses: [
    { id: 'protese-1', title: 'Pr√≥tese Realista', price: 149.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-2', title: 'Plug Anal Pequeno', price: 39.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-3', title: 'Plug Anal M√©dio', price: 49.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-4', title: 'Plug Anal Grande', price: 59.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-5', title: 'Pr√≥tese Dupla', price: 169.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-6', title: 'Pr√≥tese Vibrat√≥ria', price: 189.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-7', title: 'Plug Anal Vibrat√≥rio', price: 79.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-8', title: 'Pr√≥tese Realista Plus', price: 199.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-9', title: 'Kit Plugs Anal', price: 129.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-10', title: 'Pr√≥tese Premium', price: 229.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-11', title: 'Plug Anal Jewel', price: 69.90, img: 'images/gel/gelteste.png', category: 'proteses' },
    { id: 'protese-12', title: 'Pr√≥tese Realista Gold', price: 249.90, img: 'images/gel/gelteste.png', category: 'proteses' }
  ],
  fantasia: [
    { id: 'fantasia-1', title: 'Fantasia Enfermeira', price: 89.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-2', title: 'Fantasia Policial', price: 99.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-3', title: 'Fantasia Coelhinha', price: 79.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-4', title: 'Fantasia Borboleta', price: 69.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-5', title: 'Fantasia Super-hero√≠na', price: 109.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-6', title: 'Fantasia Fada', price: 84.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-7', title: 'Fantasia Vampira', price: 94.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-8', title: 'Fantasia Angel', price: 89.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-9', title: 'Fantasia Devil', price: 99.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-10', title: 'Fantasia French Maid', price: 79.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-11', title: 'Fantasia Schoolgirl', price: 74.90, img: 'images/gel/gelteste.png', category: 'fantasia' },
    { id: 'fantasia-12', title: 'Fantasia Cop', price: 89.90, img: 'images/gel/gelteste.png', category: 'fantasia' }
  ],
  lingeries: [
    { id: 'lingerie-1', title: 'Lingerie Rendada', price: 69.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-2', title: 'Lingerie Sensual', price: 79.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-3', title: 'Lingerie Couro', price: 99.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-4', title: 'Lingerie Babydoll', price: 89.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-5', title: 'Lingerie Bodystocking', price: 109.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-6', title: 'Lingerie Transparente', price: 74.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-7', title: 'Lingerie Vermelha', price: 84.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-8', title: 'Lingerie Preta', price: 79.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-9', title: 'Lingerie Branca', price: 69.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-10', title: 'Lingerie Azul', price: 89.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-11', title: 'Lingerie Verde', price: 79.90, img: 'images/gel/gelteste.png', category: 'lingeries' },
    { id: 'lingerie-12', title: 'Lingerie Roxa', price: 94.90, img: 'images/gel/gelteste.png', category: 'lingeries' }
  ],
  sado: [
    { id: 'sado-1', title: 'Algemas de Metal', price: 59.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-2', title: 'M√°scara de Couro', price: 49.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-3', title: 'Chicote de Couro', price: 69.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-4', title: 'Coleira com Corrente', price: 39.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-5', title: 'Morda√ßa de Borracha', price: 34.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-6', title: 'Spanker de Couro', price: 54.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-7', title: 'Cinta de Castidade', price: 129.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-8', title: 'Algemas de Velcro', price: 44.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-9', title: 'M√°scara de Latex', price: 59.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-10', title: 'Chicote de Cabelo', price: 79.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-11', title: 'Coleira com Spike', price: 49.90, img: 'images/gel/gelteste.png', category: 'sado' },
    { id: 'sado-12', title: 'Kit Sado B√°sico', price: 149.90, img: 'images/gel/gelteste.png', category: 'sado' }
  ],
  higiene: [
    { id: 'higiene-1', title: 'Sabonete √çntimo', price: 24.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-2', title: 'Len√ßo Umedecido', price: 19.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-3', title: 'Hidratante √çntimo', price: 34.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-4', title: 'Spray √çntimo', price: 29.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-5', title: 'Creme Hidratante', price: 39.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-6', title: '√ìleo Corporal', price: 44.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-7', title: 'Gel de Limpeza', price: 27.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-8', title: 'Sabonete L√≠quido', price: 22.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-9', title: 'Creme Relaxante', price: 37.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-10', title: 'Spray Refrescante', price: 31.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-11', title: 'Lo√ß√£o Corporal', price: 42.90, img: 'images/gel/gelteste.png', category: 'higiene' },
    { id: 'higiene-12', title: 'Kit Higiene √çntima', price: 89.90, img: 'images/gel/gelteste.png', category: 'higiene' }
  ],
  salao: [
    { id: 'salao-1', title: 'Vibrador Bullet - Promo', price: 39.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-2', title: 'Lubrificante - Oferta', price: 29.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-3', title: 'Anel Peniano - Desconto', price: 19.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-4', title: 'Plug Anal - Liquida√ß√£o', price: 34.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-5', title: 'Lingerie - Promocional', price: 49.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-6', title: 'Fantasia - Oferta', price: 59.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-7', title: 'Masturbador - Desconto', price: 69.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-8', title: 'Acess√≥rio - Promo√ß√£o', price: 24.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-9', title: 'Cosm√©tico - Liquida√ß√£o', price: 34.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-10', title: 'Brinquedo - Oferta', price: 79.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-11', title: 'Pr√≥tese - Promocional', price: 99.90, img: 'images/gel/gelteste.png', category: 'salao' },
    { id: 'salao-12', title: 'Sado - Desconto', price: 44.90, img: 'images/gel/gelteste.png', category: 'salao' }
  ],
  'mais-vendidos': [
    { id: 'mais-vendido-1', title: 'Vibrador Rabbit Premium', price: 19.90, img: 'images/gel/cremeteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-2', title: 'Sache Gel Excitante Plus', price: 2.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-3', title: 'Lingerie Sensual Premium', price: 89.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-4', title: 'Masturbador Realista', price: 129.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-5', title: 'Plug Anal Jewel', price: 69.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-6', title: 'Anel Peniano Vibrat√≥rio', price: 79.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-7', title: 'Fantasia Enfermeira Plus', price: 99.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-8', title: 'Lubrificante Aquecedor', price: 44.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-9', title: 'Kit Acess√≥rios Premium', price: 119.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-10', title: 'Vibrador Wand Plus', price: 179.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-11', title: 'Pr√≥tese Realista Gold', price: 199.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' },
    { id: 'mais-vendido-12', title: 'Masturbador Control Remoto', price: 159.90, img: 'images/gel/gelteste.png', category: 'mais-vendidos' }
  ]
};

/* ALL PRODUCTS para home (pegar os primeiros 12 de todas categorias) */
let ALL_PRODUCTS = [];
Object.keys(PRODUCTS_BY_CATEGORY).forEach(k => ALL_PRODUCTS = ALL_PRODUCTS.concat(PRODUCTS_BY_CATEGORY[k]));
if(ALL_PRODUCTS.length > 24) ALL_PRODUCTS = ALL_PRODUCTS.slice(0,12);

/* Estado SPA e carrinho */
let current = 'home';
const CART_KEY = 'amora_cart_v3';
let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');

/* ---------- Util ---------- */
function formatMoney(v){ return 'R$ ' + Number(v).toFixed(2).replace('.',','); }
function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartUI(); }
function cartTotal(){ return cart.reduce((s,i)=> s + (i.price * i.qty), 0); }
function findProductById(id){
  for(const k in PRODUCTS_BY_CATEGORY){
    const f = PRODUCTS_BY_CATEGORY[k].find(p=>p.id===id);
    if(f) return f;
  }
  return null;
}

/* ---------- Render menu ---------- */
const navMenu = document.getElementById('navMenu');
CATEGORIES.forEach(cat=>{
  const li = document.createElement('li');
  const btn = document.createElement('button');
  btn.textContent = cat.label;
  btn.dataset.key = cat.key;
  btn.addEventListener('click', ()=> {
    if(cat.key === 'home') goHome();
    else goToCategory(cat.key);
  });
  li.appendChild(btn);
  navMenu.appendChild(li);
});

/* Logo click -> home */
document.getElementById('logoBtn').addEventListener('click', goHome);

/* ---------- Render products ---------- */
const productsGrid = document.getElementById('productsGrid');
function renderProducts(list){
  productsGrid.innerHTML = '';
  if(list.length === 0){
    productsGrid.innerHTML = `<div style="grid-column:1/-1;background:#fff;padding:18px;border-radius:10px;box-shadow:0 5px 14px rgba(0,0,0,.04)">Nenhum produto encontrado.</div>`;
    return;
  }
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <div class="product-img"><img src="${p.img}" alt="${p.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x300?text=Imagem+Indispon√≠vel'"></div>
      <div class="product-body">
        <div class="product-title">${p.title}</div>
        <div class="product-price">${formatMoney(p.price)}</div>
        <div class="product-actions">
          <button class="add-btn" data-add="${p.id}">Adicionar ao Carrinho</button>
          <button class="small-btn favorite-btn" data-fav="${p.id}">‚ù§Ô∏è</button>
        </div>
      </div>
    `;
    productsGrid.appendChild(card);
  });
}

/* Home view */
function goHome(){
  current = 'home';
  document.getElementById('hero').style.display = 'flex';
  document.getElementById('sectionTitle').textContent = 'Produtos em Destaque';
  renderProducts(ALL_PRODUCTS);
  window.scrollTo({top:0,behavior:'smooth'});
}

/* Category view */
function goToCategory(key){
  current = key;
  document.getElementById('hero').style.display = 'none';
  if(key === 'contato'){
    document.getElementById('sectionTitle').textContent = 'Contato';
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = `<div style="grid-column:1/-1;background:#fff;padding:18px;border-radius:10px;box-shadow:0 5px 14px rgba(0,0,0,.04)">
      <h3>Fale Conosco</h3>
      <p>Telefone: ${STORE_PHONE_DISPLAY}</p>
      <p>Email: g6pousoalegre@gmail.com</p>
      <p>Endere√ßo: Itajub√° - MG</p>
    </div>`;
    return;
  }
  const list = PRODUCTS_BY_CATEGORY[key] || [];
  document.getElementById('sectionTitle').textContent = CATEGORIES.find(c=>c.key===key)?.label || 'Categoria';
  renderProducts(list);
  window.scrollTo({top:0,behavior:'smooth'});
}

/* Inicial */
goHome();

/* ---------- Search ---------- */
document.getElementById('searchInput').addEventListener('input', function(){
  const q = this.value.trim().toLowerCase();
  if(!q){
    (current === 'home') ? renderProducts(ALL_PRODUCTS) : goToCategory(current);
    return;
  }
  let pool = [];
  Object.keys(PRODUCTS_BY_CATEGORY).forEach(k => pool = pool.concat(PRODUCTS_BY_CATEGORY[k]));
  const found = pool.filter(p => p.title.toLowerCase().includes(q));
  document.getElementById('sectionTitle').textContent = `Resultados para "${q}" (${found.length})`;
  renderProducts(found);
});

/* ---------- Cart logic ---------- */
function updateCartUI(){
  const cartCount = document.getElementById('cart-count');
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');
  cartCount.textContent = cart.reduce((s,i)=>s+i.qty,0);
  cartItemsEl.innerHTML = '';
  if(cart.length === 0) cartItemsEl.innerHTML = '<div style="padding:18px;color:#666">Seu carrinho est√° vazio.</div>';
  cart.forEach(item=>{
    const el = document.createElement('div');
    el.className = 'cart-item';
    el.innerHTML = `
      <img src="${item.img}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/300x300?text=Imagem+Indispon√≠vel'" />
      <div style="flex:1">
        <div style="font-weight:700">${item.title}</div>
        <div style="margin-top:6px;color:#666">Qtd: ${item.qty} ‚Ä¢ ${formatMoney(item.price)}</div>
        <div style="margin-top:8px;display:flex;gap:6px">
          <button class="small-btn" data-action="minus" data-id="${item.id}">-</button>
          <button class="small-btn" data-action="plus" data-id="${item.id}">+</button>
          <button class="small-btn" data-action="remove" data-id="${item.id}">Remover</button>
        </div>
      </div>
    `;
    cartItemsEl.appendChild(el);
  });
  cartTotalEl.textContent = formatMoney(cartTotal());
  document.getElementById('modalTotal').textContent = formatMoney(cartTotal());
  renderMiniSummary();
}

/* Add to cart delegation */
document.addEventListener('click', function(e){
  const t = e.target;
  if(t.dataset.add){
    const pid = t.dataset.add;
    const prod = findProductById(pid);
    if(!prod) return alert('Produto n√£o encontrado');
    const inCart = cart.find(i=>i.id===pid);
    if(inCart) inCart.qty++;
    else cart.push({ id:prod.id, title:prod.title, price:prod.price, qty:1, img:prod.img });
    saveCart();
    t.textContent = 'Adicionado!';
    setTimeout(()=> t.textContent = 'Adicionar ao Carrinho',900);
  }

  if(t.classList.contains('favorite-btn')){
    t.classList.toggle('active');
  }

  if(t.id === 'open-cart-btn') openCart();
  if(t.id === 'closeCartBtn') closeCart();

  if(t.dataset.action){
    const id = t.dataset.id;
    const action = t.dataset.action;
    const idx = cart.findIndex(i=>i.id === id);
    if(idx === -1) return;
    if(action === 'plus') cart[idx].qty++;
    if(action === 'minus'){ cart[idx].qty--; if(cart[idx].qty<=0) cart.splice(idx,1); }
    if(action === 'remove') cart.splice(idx,1);
    saveCart();
  }

  if(t.id === 'clearCartBtn'){ if(confirm('Deseja limpar o carrinho?')){ cart=[]; saveCart(); } }

  if(t.id === 'checkoutBtn'){ openPaymentModal(); }
});

/* Open/close cart */
const cartDrawer = document.getElementById('cartDrawer');
function openCart(){ cartDrawer.classList.add('open'); cartDrawer.setAttribute('aria-hidden','false'); updateCartUI(); }
function closeCart(){ cartDrawer.classList.remove('open'); cartDrawer.setAttribute('aria-hidden','true'); }

/* Persist√™ncia */
(function(){ const saved = JSON.parse(localStorage.getItem(CART_KEY) || '[]'); if(saved && Array.isArray(saved)){ cart = saved; updateCartUI(); } })();
function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartUI(); }

/* Mini summary in modal */
function renderMiniSummary(){
  const mini = document.getElementById('miniCartSummary');
  if(cart.length===0){ mini.innerHTML = '<div>Nenhum item</div>'; return; }
  let html = '<ul style="list-style:none;padding:0;margin:0">';
  cart.forEach(i=> html += `<li style="margin-bottom:6px">${i.qty}x ${i.title} ‚Äî ${formatMoney(i.price)}</li>`);
  html += '</ul>';
  mini.innerHTML = html;
}

/* ---------- Payment: build BR Code PIX (EMV) with CRC16 ---------- */
/* We'll build a BR Code (EMV) string that many banks recognize.
   This algorithm constructs EMV tags for merchant, pix key, amount (optional), and calculates CRC16-CCITT (0x1021 init 0xFFFF).
   Note: For total production reliability, server-side generation is recommended, but this works for client-side flows.
*/

function pad2(v){ return v.toString().padStart(2,'0'); }
function tlv(id, value){
  if(value == null) return '';
  const len = String(value.length).padStart(2,'0');
  return id + len + value;
}
function crc16(str){
  // CRC16/CCITT-FALSE implementation
  let crc = 0xFFFF;
  for (let i = 0; i < str.length; i++) {
    crc ^= str.charCodeAt(i) << 8;
    for (let j = 0; j < 8; j++) {
      crc = (crc & 0x8000) ? ((crc << 1) ^ 0x1021) : (crc << 1);
      crc &= 0xFFFF;
    }
  }
  return crc.toString(16).toUpperCase().padStart(4,'0');
}

function buildBRCode({pixKey, merchantName, merchantCity, amount, txid}){
  // 00: Payload Format Indicator
  // 26: Merchant Account Info -> 00: GUI, 01: Key (pix), 02: optional description? We'll use 00 GUI + 01 key
  // 52: Merchant Category Code
  // 53: Transaction Currency (986 BRL)
  // 54: Transaction Amount (optional)
  // 58: Country Code (BR)
  // 59: Merchant Name
  // 60: Merchant City
  // 62: Additional Data Field Template -> 05: TxID
  let payload = '';
  payload += tlv('00','01'); // vers√£o
  // Merchant Account Information (Pix)
  const gui = 'br.gov.bcb.pix';
  let mai = '';
  mai += tlv('00', gui);
  // 01 -> chave pix
  mai += tlv('01', pixKey);
  // 02 -> description optional omitted
  payload += tlv('26', mai);
  payload += tlv('52', '0000');
  payload += tlv('53', '986');
  if(amount && amount > 0) payload += tlv('54', amount.toFixed(2).replace('.',','));
  payload += tlv('58', 'BR');
  payload += tlv('59', (merchantName || 'AMORA SECRETA').substring(0,25));
  payload += tlv('60', (merchantCity || 'ITAJUBA').substring(0,15));
  // Additional Data Field Template
  const add = tlv('05', (txid || '***'));
  payload += tlv('62', add);
  // CRC placeholder
  const payloadForCrc = payload + '6304';
  const crc = crc16(payloadForCrc);
  return payloadForCrc + crc;
}

/* Build copy&paste text for fallback */
function buildPixCopyText(amount, pixKey){
  const valorStr = amount.toFixed(2).replace('.',',');
  return `CHAVE:${pixKey};VALOR:${valorStr};LOJA:${STORE_NAME}`;
}

/* Update pix area when opening modal */
const paymentModal = document.getElementById('paymentModal');
const pixPanel = document.getElementById('pixPanel');
const cardPanel = document.getElementById('cardPanel');
const boletoPanel = document.getElementById('boletoPanel');
const pixOption = document.getElementById('pixOption');
const cardOption = document.getElementById('cardOption');
const boletoOption = document.getElementById('boletoOption');

document.getElementById('closePaymentModal').addEventListener('click', closePaymentModal);
pixOption.addEventListener('click', ()=> showPanel('pix'));
cardOption.addEventListener('click', ()=> showPanel('card'));
boletoOption.addEventListener('click', ()=> showPanel('boleto'));

function openPaymentModal(){
  if(cart.length === 0){ alert('Seu carrinho est√° vazio. Adicione produtos antes de finalizar.'); return; }
  paymentModal.classList.add('open');
  paymentModal.setAttribute('aria-hidden','false');
  showPanel('pix');
  renderMiniSummary();
  updatePixArea();
}
function closePaymentModal(){ paymentModal.classList.remove('open'); paymentModal.setAttribute('aria-hidden','true'); document.getElementById('qrBox').style.display='none'; }
function showPanel(which){
  pixPanel.style.display = which === 'pix' ? 'block' : 'none';
  cardPanel.style.display = which === 'card' ? 'block' : 'none';
  boletoPanel.style.display = which === 'boleto' ? 'block' : 'none';
}

/* Update pix text and QR */
function updatePixArea(){
  const amount = cartTotal();
  const pixText = buildPixCopyText(amount, PIX_KEY);
  document.getElementById('pixCopyArea').textContent = pixText;
  document.getElementById('pixKeyDisplay').textContent = PIX_KEY;
  document.getElementById('modalTotal').textContent = formatMoney(amount);
  document.getElementById('qrBox').style.display = 'none';
}

/* Copy pix text */
document.getElementById('copyPixBtn').addEventListener('click', function(){
  const amount = cartTotal();
  const copy = buildPixCopyText(amount, PIX_KEY);
  navigator.clipboard.writeText(copy).then(()=>{
    this.textContent = 'Copiado!';
    setTimeout(()=> this.textContent = 'Copiar C√≥digo PIX (com valor)', 2000);
  });
});

/* Show QR (BR Code) */
document.getElementById('showQrBtn').addEventListener('click', function(){
  const amount = cartTotal();
  // amount string for EMV needs decimal with dot; we'll pass numeric
  const txid = `PED-${Date.now().toString().slice(-6)}`;
  const brCode = buildBRCode({ pixKey: PIX_KEY, merchantName: STORE_NAME, merchantCity: 'ITAJUBA', amount: amount, txid });
  // Generate QR via Google Chart API for convenience
  const qrUrl = `https://chart.googleapis.com/chart?cht=qr&chs=350x350&chl=${encodeURIComponent(brCode)}`;
  document.getElementById('qrImage').src = qrUrl;
  document.getElementById('qrBox').style.display = 'block';
});

/* Send order by WhatsApp */
document.getElementById('whatsappPayBtn').addEventListener('click', function(){
  if(cart.length === 0){ alert('Carrinho vazio'); return; }
  let msg = `Ol√°, gostaria de finalizar meu pedido na ${STORE_NAME}%0A`;
  msg += `Telefone: ${STORE_PHONE_DISPLAY}%0A`;
  msg += `-- Pedido --%0A`;
  cart.forEach(i=>{
    msg += `${i.qty}x ${i.title} - ${formatMoney(i.price)}%0A`;
  });
  msg += `%0ATotal: ${formatMoney(cartTotal())}%0A%0A`;
  msg += `Vou pagar via PIX (chave: ${PIX_KEY}).`;
  const wa = `https://wa.me/${STORE_PHONE_INTERNAL}?text=${encodeURIComponent(decodeURIComponent(msg))}`;
  window.open(wa, '_blank');
});

/* Simulated card and boleto */
document.getElementById('simulateCardBtn').addEventListener('click', function(){
  alert('Pagamento por cart√£o (simulado) realizado. Obrigado!');
  cart = []; saveCart(); closePaymentModal(); closeCart();
});
document.getElementById('simulateBoletoBtn').addEventListener('click', function(){
  alert('Boleto (simulado) gerado e enviado por e-mail.');
  cart = []; saveCart(); closePaymentModal(); closeCart();
});

/* ---------- Open/close cart buttons ---------- */
document.getElementById('open-cart-btn').addEventListener('click', openCart);
document.getElementById('closeCartBtn').addEventListener('click', closeCart);

/* ---------- init ---------- */
updateCartUI();
window.addEventListener('load', ()=> updateCartUI());

/* Optional: keyboard 'c' to open cart (dev) */
// document.addEventListener('keydown', e=>{ if(e.key==='c') openCart(); });

</script>
</body>
</html>
