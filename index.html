

   /* ======================
   Configura√ß√µes da loja
   ====================== */
const STORE_NAME = 'AMORA SECRETA';
const STORE_PHONE_INTERNAL = '5535999739111';
const STORE_PHONE_DISPLAY = '(35) 99973-9111';
const PIX_KEY = '35999739111';

// ‚úÖ URL das Netlify Functions
const NETLIFY_FUNCTION_URL = '/.netlify/functions/process-payment';
const CREATE_PREFERENCE_URL = '/.netlify/functions/create-preference';

// ... (mantenha CATEGORIES e PRODUCTS_BY_CATEGORY) ...

/* ---------- Integra√ß√£o com Netlify Functions ---------- */
async function processPaymentWithNetlify(paymentData) {
    showProcessing();
    
    try {
        console.log('üîÑ Enviando para Netlify Function...');
        
        const response = await fetch(NETLIFY_FUNCTION_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(paymentData)
        });
        
        if (!response.ok) {
            throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
            showPaymentSuccess();
            
            // Limpar carrinho ap√≥s sucesso
            setTimeout(() => {
                cart = [];
                saveCart();
                closePaymentModal();
                closeCart();
                
                // Opcional: redirecionar para p√°gina de sucesso
                // window.location.href = '/sucesso.html';
                
            }, 3000);
            
        } else {
            throw new Error(result.error || 'Erro no processamento');
        }
        
    } catch (error) {
        console.error('‚ùå Erro:', error);
        showPaymentError('Erro: ' + error.message);
    }
}

/* ---------- Processar Pagamento com Cart√£o ---------- */
function processCardPayment() {
    const name = document.getElementById('cardholderName').value;
    const email = document.getElementById('cardholderEmail').value;
    const doc = document.getElementById('cardholderDoc').value;
    
    if (!name || !email || !doc) {
        alert('Por favor, preencha todos os dados obrigat√≥rios.');
        return;
    }
    
    const paymentData = {
        transactionAmount: cartTotal(),
        description: `Compra na ${STORE_NAME} - ${cart.length} itens`,
        installments: parseInt(document.getElementById('installments').value) || 1,
        payment_method: 'credit_card',
        payer: {
            email: email,
            identification: {
                type: 'CPF',
                number: doc.replace(/\D/g, '')
            }
        },
        metadata: {
            items: cart,
            store: STORE_NAME,
            customer_name: name
        }
    };
    
    processPaymentWithNetlify(paymentData);
}

/* ---------- Processar Boleto ---------- */
function processBoletoPayment() {
    const name = document.getElementById('boletoName').value;
    const email = document.getElementById('boletoEmail').value;
    const doc = document.getElementById('boletoDoc').value;
    
    if (!name || !email || !doc) {
        alert('Por favor, preencha todos os dados para gerar o boleto.');
        return;
    }
    
    const paymentData = {
        transactionAmount: cartTotal(),
        description: `Compra na ${STORE_NAME} - Boleto`,
        payment_method: 'bolbradesco',
        payer: {
            email: email,
            first_name: name.split(' ')[0],
            last_name: name.split(' ').slice(1).join(' '),
            identification: {
                type: 'CPF',
                number: doc.replace(/\D/g, '')
            }
        },
        metadata: {
            items: cart,
            store: STORE_NAME
        }
    };
    
    processPaymentWithNetlify(paymentData);
}

// ... (mantenha o resto das fun√ß√µes de utilidade) ...

/* ---------- Event Listeners para Pagamento ---------- */
document.addEventListener('DOMContentLoaded', function() {
    // Cart√£o
    const processCardBtn = document.getElementById('processCardPayment');
    if (processCardBtn) {
        processCardBtn.addEventListener('click', function(e) {
            e.preventDefault();
            processCardPayment();
        });
    }
    
    // Boleto
    const generateBoletoBtn = document.getElementById('generateBoleto');
    if (generateBoletoBtn) {
        generateBoletoBtn.addEventListener('click', function(e) {
            e.preventDefault();
            processBoletoPayment();
        });
    }
});

// ... (mantenha todas as outras fun√ß√µes: updateCartUI, saveCart, etc.) ...
